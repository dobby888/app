<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Expense</title>
  </head>
  <body>
    <form onsubmit="addNewExpense(event)" action="/user/addExpenses" method="POST">
      <label for="spentAmount">Amount Spent:</label>
      <input type="number" id="spentAmount" name="spentAmount" required autocomplete="spentAmount"><br>
      <label for="spentDes">spentDes:</label>
      <input type="text" id="spentDes" name="spentDes" required autocomplete="spentDes"><br>
      <label for="category">Category:</label>
      <select id="category" name="category" style="width: 100%; height: 30px">
        <option value="education">Education</option>
        <option value="food">Food</option>
        <option value="medical">Medical</option>
        <option value="family">Family</option>
        <option value="grocery">Grocery</option>
        <option value="rent">Rent</option>
        <option value="transport">Transport</option>
        <option value="entertainment">Entertainment</option></select>
      ><br /><br />
      <button type="submit">Add Expense</button>
    </form>
    <ul class="list-group" id="expenseList"></ul>
    <!-- ... (your HTML code above) ... -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.2/axios.js"></script>
<script>
  function addNewExpense(e){
    e.preventDefault();
    const form = new FormData(e.target);

    const expenseDetails = {
        spentAmount: form.get("spentAmount"),
        spentDes: form.get("spentDes"),
        category: form.get("category")

    }
    const token = localStorage.getItem('token');
    console.log(expenseDetails)
    axios.post('http://localhost:8000/user/addExpenses',expenseDetails, { 
        headers: {
            "Authorization": `Bearer ${token}`, // Use Bearer token format
            "Content-Type": "application/json", // Set Content-Type
        } }).then((response) => {

    if(response.status === 201){
        addNewExpensetoUI(response.data);
    } else {
        throw new Error('Failed To create new expense');
    }

    }).catch(err => showError(err))

}

window.addEventListener('load', ()=> {
    const token = localStorage.getItem('token');
    axios.get('http://localhost:8000/user/expenses', { headers: {"Authorization" : token} }).then(response => {
        if(response.status === 200){
            response.data.forEach(expense => {

                addNewExpense(expense);
            })
        } else {
            throw new Error();
        }
    })
});

function addNewExpensetoUI(expense){
    const parentElement = document.getElementById('expenseList');
    const expenseElemId = `expense-${expense.id}`;
    parentElement.innerHTML += `
        <li id=${expenseElemId}>
            ${expense.spentAmount} - ${expense.category} - ${expense.spentDes}
            <button onclick='deleteExpense(event, ${expense.id})'>
                Delete Expense
            </button>
        </li>`
}

function deleteExpense(e, expenseid) {
    const token = localStorage.getItem('token');
    axios.delete(`http://localhost:8000/user/deleteexpense/${expenseid}`, { headers: {"Authorization" : token} }).then((response) => {

    if(response.status === 204){
            removeExpensefromUI(expenseid);
        } else {
            throw new Error('Failed to delete');
        }
    }).catch((err => {
        showError(err);
    }))
}

function showError(err){
    document.body.innerHTML += `<div style="color:red;"> ${err}</div>`
}

function removeExpensefromUI(expenseid){
    const expenseElemId = `expense-${expenseid}`;
    document.getElementById(expenseElemId).remove();
}
</script>

<!-- ... (your HTML code below) ... -->

  </body>
</html>
